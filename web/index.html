<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link href="styles.css" rel="stylesheet" />
    <script type="text/javascript">
    const DEBUG = true; // Set to true for debugging peg

    const DEBUG_SCRIPTS = ['../src/memo.js', '../src/memo.tools.js', '../src/memo.preprocess.js', '../build/memo.parser.js', '../src/memo.interpreter.js'];
    const PROD_SCRIPT = ['memo.js'];

    function loadScripts() {
        const scripts = DEBUG ? DEBUG_SCRIPTS : PROD_SCRIPT;
        scripts.forEach(src => {
            const script = document.createElement('script');
            script.src = src;
            script.async = false; // Ensure scripts are loaded in order
            document.head.appendChild(script);
        });
    }
    loadScripts();
    </script>
    <script src="state-manager.js" type="text/javascript"></script>
    <script src="script.js" type="text/javascript"></script>
    <title>[]memo</title>
    <script type="text/javascript">

    function open_modal() {
        var modal = document.getElementById("modal");
        var modal_content = document.getElementById("modal_content");
        modal.style.display = "block";
        modal_content.style.display = "block";
    }

    function close_modal(e) {
       var modal = document.getElementById("modal");
       var modal_content = document.getElementById("modal");
       // Only refocus if modal was actually open
       var wasOpen = modal.style.display !== "none";
       modal.style.display = "none";
       modal_content.style.display = "none";
       if (wasOpen) {
           document.getElementById("n").focus();
       }
    }

    function close_modal_and_remember(e) {
       close_modal(e);
       // Mark modal as dismissed so it doesn't show again
       if (typeof MemoStateManager !== 'undefined') {
           MemoStateManager.setModalDismissed();
       }
    }

    function toggleView() {
        const stateView = document.getElementById('state');
        const canvasView = document.getElementById('canvas-view');
        const toggleKnob = document.getElementById('toggle-knob');
        
        if (stateView.classList.contains('active')) {
            stateView.classList.remove('active');
            canvasView.classList.add('active');
            toggleKnob.classList.add('right');
        } else {
            canvasView.classList.remove('active');
            stateView.classList.add('active');
            toggleKnob.classList.remove('right');
        }
        
        // Stop propagation to prevent modal close
        event.stopPropagation();
    }

    window.addEventListener("load", function() {
        // Only show modal on first visit (if it hasn't been dismissed before)
        let shouldShowModal = true;
        if (typeof MemoStateManager !== 'undefined') {
            const wasDismissed = MemoStateManager.wasModalDismissed();
            if (wasDismissed) {
                shouldShowModal = false;
            }
        }
        
        if (shouldShowModal) {
            open_modal();
        }
        
        document.getElementsByTagName("body")[0].onclick = close_modal_and_remember;
        document.getElementById("modal_content").onclick = (e) => {
            e.stopPropagation();
        };
        document.getElementById("close").onclick = close_modal_and_remember;
    });
    </script>
</head>
<body>
    <div id="state-container">
        <div id="view-toggle" class="rocker-switch" onclick="toggleView();">
            <div id="toggle-knob" class="toggle-knob right"></div>
        </div>
        
        <div id="state" class="view-panel">
            <h1><a href="javascript:open_modal();">[] memo</a></h1><br/>
            <table id="state_table"><tbody></tbody></table>
        </div>
        
        <div id="canvas-view" class="view-panel active">
            <h1><a href="javascript:open_modal();">[] memo</a></h1><br/>
            <canvas id="memo-canvas"></canvas>
        </div>
    </div>
    <div id="box">
        <div id="content">
        <div id="fadeout">
            <span id="n-12"></span>
            <span id="n-11"></span>
            <span id="n-10"></span>
            <span id="n-9"></span>
            <span id="n-8"></span>
            <span id="n-7"></span>
            <span id="n-6"></span>
            <span id="n-5"></span>
            <span id="n-4"></span>
            <span id="n-3"></span>
            <span id="n-2"></span>
            <span id="n-1"></span>
        </div>
        <div id="entry"><textarea type="text" id="n" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea></div>
        </div>
        <div id="filler"></div>
    </div>
    <div id="modal"><div id="modal_content"><span class="close" id='close'>&times;</span>
        <p><span class="memo">[]memo</span> is a  stream-of-conscious coding environment. You have one program, always becoming something new. Each time you return, it picks up where you left off. As lines of code scroll off the screen, they are forgotten.
        </p><p>    
            <span class="memo">[]memo</span> is functional and uses natural-language syntax:</p>
        <code>Remember <span class="vrbl">function-name</span> with <span class="vrbl">arguments</span> as body.</code>
        <p>List elements are seperated by commas, <span class="inline">and</span>s or both. <span class="memo">[]memo</span> ignores numerals like <span class="inline">4</span> and expects <span class="inline">four</span> instead:</p>
        <code>Remember <span class="vrbl">p</span> as one, two, and three.</code>
        <p>Print with the <span class="inline">Tell me</span> command:</p>
        <code>Tell me about <span class="vrbl">name.</span></code>
        <p>Some values are approximated.
        Cookies are used only to store program state. Read more on <a href="https://github.com/rottytooth/memo">GitHub...</a></p>
            
        <p>This language is part of <a href="https://mitpress.mit.edu/9780262553087/forty-four-esolangs/">Forty-Four Esolangs</a>, a book by <a href="https://danieltemkin.com/Esolangs">Daniel Temkin</a>.</p>
    </div>
</body></html>