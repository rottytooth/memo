<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link href="styles.css" rel="stylesheet" />
    <script type="text/javascript">
    const DEBUG = true; // Set to true for debugging peg

    const DEBUG_SCRIPTS = ['../src/memo.js', '../src/memo.tools.js', '../src/memo.preprocess.js', '../build/memo.parser.js', '../src/memo.interpreter.js'];
    const PROD_SCRIPT = ['memo.js'];

    function loadScripts() {
        const scripts = DEBUG ? DEBUG_SCRIPTS : PROD_SCRIPT;
        scripts.forEach(src => {
            const script = document.createElement('script');
            script.src = src;
            script.async = false; // Ensure scripts are loaded in order
            document.head.appendChild(script);
        });
    }
    loadScripts();
    </script>
    <script src="state-manager.js" type="text/javascript"></script>
    <script src="script.js" type="text/javascript"></script>
    <title>[]memo</title>
    <script type="text/javascript">

    function open_modal() {
        var modal = document.getElementById("modal");
        var modal_content = document.getElementById("modal_content");
        modal.style.display = "block";
        modal_content.style.display = "block";
    }

    function close_modal(e) {
       var modal = document.getElementById("modal");
       var modal_content = document.getElementById("modal");
       modal.style.display = "none";
       modal_content.style.display = "none";
       document.getElementById("n").focus();
    }

    function close_modal_and_remember(e) {
       close_modal(e);
       // Mark modal as dismissed so it doesn't show again
       if (typeof MemoStateManager !== 'undefined') {
           MemoStateManager.setModalDismissed();
       }
    }

    function toggleView() {
        const stateView = document.getElementById('state');
        const canvasView = document.getElementById('canvas-view');
        const toggleKnob = document.getElementById('toggle-knob');
        
        if (stateView.classList.contains('active')) {
            stateView.classList.remove('active');
            canvasView.classList.add('active');
            toggleKnob.classList.add('right');
        } else {
            canvasView.classList.remove('active');
            stateView.classList.add('active');
            toggleKnob.classList.remove('right');
        }
        
        // Stop propagation to prevent modal close
        event.stopPropagation();
    }

    window.addEventListener("load", function() {
        // Only show modal on first visit (if it hasn't been dismissed before)
        let shouldShowModal = true;
        if (typeof MemoStateManager !== 'undefined') {
            const wasDismissed = MemoStateManager.wasModalDismissed();
            if (wasDismissed) {
                shouldShowModal = false;
            }
        }
        
        if (shouldShowModal) {
            open_modal();
        }
        
        document.getElementsByTagName("body")[0].onclick = close_modal_and_remember;
        document.getElementById("modal").onclick = () => {return true;};
        document.getElementById("close").onclick = close_modal_and_remember;
    });
    </script>
</head>
<body>
    <div id="state-container">
        <div id="view-toggle" class="rocker-switch" onclick="toggleView();">
            <div id="toggle-knob" class="toggle-knob right"></div>
        </div>
        
        <div id="state" class="view-panel">
            <h1><a href="javascript:open_modal();">[] memo</a></h1><br/>
            <table id="state_table"><tbody></tbody></table>
        </div>
        
        <div id="canvas-view" class="view-panel active">
            <h1><a href="javascript:open_modal();">[] memo</a></h1><br/>
            <canvas id="memo-canvas"></canvas>
        </div>
    </div>
    <div id="box">
        <div id="content">
        <div id="fadeout">
            <span id="n-12"></span>
            <span id="n-11"></span>
            <span id="n-10"></span>
            <span id="n-9"></span>
            <span id="n-8"></span>
            <span id="n-7"></span>
            <span id="n-6"></span>
            <span id="n-5"></span>
            <span id="n-4"></span>
            <span id="n-3"></span>
            <span id="n-2"></span>
            <span id="n-1"></span>
        </div>
        <div id="entry"><textarea type="text" id="n" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea></div>
        </div>
        <div id="filler"></div>
    </div>
    <div id="modal"><div id="modal_content"><span class="close" id='close'>&times;</span>
        <p><span class="memo">[]memo</span> is a programming language for stream-of-conscious coding. Your program picks up where you left off, always becoming something new. <span class="memo">[]memo</span> is a LISP without parentheses. Instead of writing:</p>
        <code>(defun function-name (arguments...) (body))</code>
        <p>We define functions this way:</p>
        <code>Remember function-name with arguments as body.</code>
        <p>Lists are seperated by commas, <span class="inline">and</span>s or both:</p>
        <code>Remember p as one, two, and three.</code>
        <p>To evaluate the program, ask for me to tell you about <span class="inline">name</span>:</p>
        <code>Tell me about name.</code>
        <p>I read only what is on the screen; code flows off the terminal into oblivion. Like parantheses, I ignore numerals like <span class="inline">4</span> and expect <span class="inline">four</span> instead.</p>
        <p>Cookies are used only to store program state.</p>

        <p>Read more on <a href="https://github.com/rottytooth/memo">GitHub...</a></p>
            
        <p>This language is part of <a href="https://mitpress.mit.edu/9780262553087/forty-four-esolangs/">Forty-Four Esolangs</a>, a book by <a href="https://danieltemkin.com/Esolangs">Daniel Temkin</a>.</p>
    </div>
</body></html>